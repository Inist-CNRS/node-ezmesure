#!/usr/bin/env node
'use strict';

const co       = require('co');
const yargs    = require('yargs');
const ezmesure = require('../index.js');

co(function* () {
  try {
    yield ezmesure.config.load('.ezmesurerc');
  } catch (err) {
    if (err.code !== 'ENOENT') { throw err; }
  }

  yargs.commandDir('cmds')
    .option('u', {
      alias: 'base-url',
      describe: 'API URL (ex: https://ezmesure-preprod.couperin.org/api)',
      global: true
    })
    .option('t', {
      alias: 'token',
      describe: 'Auth token',
      global: true
    })
    .option('k', {
      alias: 'insecure',
      describe: 'Allow connections to SSL without certs',
      boolean: true,
      global: true
    })
    .example('$0 indices list')
    .example('$0 indices delete univ-nancy')
    .demandCommand(1)
    .help()
    .argv;
});
